<app-page-container class="schedule-page-container">
  <!-- Header -->
  <app-page-header
    title="Agendamentos"
    subtitle="Gerencie os agendamentos da sua clínica"
    [action]="{
      label: 'Novo Agendamento',
      icon: 'plus',
      variant: 'primary'
    }"
    (actionClick)="onAppointmentAction('create', null!)">
  </app-page-header>

  <!-- Main Layout: Two Columns -->
  <div class="flex gap-6 schedule-content">
    <!-- Left Column: Calendar + Agenda List -->
    <div class="w-80 flex-shrink-0 flex flex-col gap-6 overflow-y-auto self-start">
      <!-- Calendar -->
      <div class="flex-shrink-0">
        <app-calendar
          [selectedDate]="selectedDate"
          [currentDate]="today"
          (dateSelected)="onDateSelected($event)">
        </app-calendar>
      </div>

      <!-- Agenda List -->
      <div class="flex-shrink-0">
        <app-agenda-list
          [agendas]="agendas"
          [selectedAgendas]="selectedAgendas"
          (selectionChange)="onAgendasSelectionChange($event)"
          (createClick)="onCreateSchedule()">
        </app-agenda-list>
      </div>
    </div>

    <!-- Right Column: Timelines -->
    <div class="flex-1 min-w-0 self-start" [class.overflow-x-auto]="selectedAgendas.length > 1" [class.scrollbar-visible]="selectedAgendas.length > 1">
      @if (selectedAgendas.length === 0) {
        <!-- Empty State: No Agendas Selected -->
        <app-card variant="elevated">
          <div class="text-center py-16">
            <div class="w-16 h-16 mx-auto mb-4 text-secondary-300">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-secondary-700 mb-2">Nenhuma agenda selecionada</h3>
            <p class="text-secondary-500">Selecione uma ou mais agendas para visualizar os agendamentos.</p>
          </div>
        </app-card>
      } @else {
        <!-- Timelines Container - Horizontal Scroll -->
        <div class="flex gap-3 h-full items-start" [class.overflow-x-auto]="selectedAgendas.length > 1">
          @for (agenda of getSelectedAgendasForDisplay(); track agenda.id) {
            <div [class]="selectedAgendas.length === 1 ? 'flex-1 min-w-0 flex flex-col' : 'flex-shrink-0 w-96 flex flex-col'">
              <app-schedule-timeline
                [appointments]="getFilteredAppointmentsForAgenda(agenda.id)"
                [resourceName]="agenda.name"
                [resourceCategory]="agenda.category === 'veterinary' ? 'Veterinária' : agenda.category === 'grooming' ? 'Banho e Tosa' : 'Hotel'"
                [resourceColor]="agenda.color"
                [startHour]="getAgendaStartHour(agenda)"
                [endHour]="getAgendaEndHour(agenda)"
                [currentTime]="currentTime"
                [intervalMinutes]="getAgendaIntervalMinutes(agenda)"
                (slotClick)="onSlotClick($event, agenda.id)"
                (appointmentClick)="onAppointmentClick($event)">
              </app-schedule-timeline>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Modais -->
  <app-schedule-form
    [schedule]="selectedSchedule"
    [isOpen]="showScheduleForm"
    (close)="onScheduleFormClose()"
    (saved)="onScheduleFormSaved($event)">
  </app-schedule-form>

  <app-appointment-form
    [appointment]="selectedAppointment"
    [scheduleId]="selectedScheduleId"
    [date]="selectedAppointmentDate"
    [time]="selectedAppointmentTime"
    [isOpen]="showAppointmentForm"
    (close)="onAppointmentFormClose()"
    (saved)="onAppointmentFormSaved($event)">
  </app-appointment-form>
</app-page-container>

<div class="pet-form-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>{{ isEditMode ? 'Editar Pet' : 'Novo Pet' }}</h1>
      <p>{{ isEditMode ? 'Atualize as informações do pet' : 'Cadastre um novo pet para a clínica' }}</p>
    </div>
  </div>

  <!-- Error Message -->
  @if (error) {
    <div class="error-message">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
      {{ error }}
    </div>
  }

  <!-- Loading -->
  @if (loading) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>{{ isEditMode ? 'Carregando pet...' : 'Salvando pet...' }}</p>
    </div>
  }

  <!-- Form -->
  @if (!loading) {
    <form [formGroup]="petForm" (ngSubmit)="onSubmit()" class="pet-form">
      <div class="form-grid">
        <!-- Informações Básicas -->
        <div class="form-section">
          <h3>Informações Básicas</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="name">Nome do Pet *</label>
              <input 
                type="text" 
                id="name" 
                formControlName="name" 
                placeholder="Digite o nome do pet"
                [class.error]="petForm.get('name')?.invalid && petForm.get('name')?.touched"
              >
              @if (petForm.get('name')?.invalid && petForm.get('name')?.touched) {
                <span class="error-text">Nome é obrigatório e deve ter pelo menos 2 caracteres</span>
              }
            </div>

            <div class="form-group">
              <label for="species">Espécie *</label>
              <select 
                id="species" 
                formControlName="species"
                [class.error]="petForm.get('species')?.invalid && petForm.get('species')?.touched"
              >
                <option value="">Selecione a espécie</option>
                @for (option of speciesOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
              @if (petForm.get('species')?.invalid && petForm.get('species')?.touched) {
                <span class="error-text">Espécie é obrigatória</span>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="breed">Raça</label>
              <input 
                type="text" 
                id="breed" 
                formControlName="breed" 
                placeholder="Digite a raça"
              >
            </div>

            <div class="form-group">
              <label for="gender">Gênero</label>
              <select id="gender" formControlName="gender">
                <option value="">Selecione o gênero</option>
                @for (option of genderOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="birthDate">Data de Nascimento</label>
              <input 
                type="date" 
                id="birthDate" 
                formControlName="birthDate"
              >
            </div>

            <div class="form-group">
              <label for="weight">Peso (kg)</label>
              <input 
                type="number" 
                id="weight" 
                formControlName="weight" 
                placeholder="0.0"
                step="0.1"
                min="0"
                [class.error]="petForm.get('weight')?.invalid && petForm.get('weight')?.touched"
              >
              @if (petForm.get('weight')?.invalid && petForm.get('weight')?.touched) {
                <span class="error-text">Peso deve ser um número positivo</span>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="color">Cor</label>
              <input 
                type="text" 
                id="color" 
                formControlName="color" 
                placeholder="Digite a cor"
              >
            </div>

            <div class="form-group">
              <label for="microchip">Microchip</label>
              <input 
                type="text" 
                id="microchip" 
                formControlName="microchip" 
                placeholder="Número do microchip"
              >
            </div>
          </div>
        </div>

                 <!-- Tutor -->
         <div class="form-section">
           <h3>Tutor Responsável</h3>
           
           @if (isEditMode && petTutor) {
             <!-- Cartão do Tutor Fixo (Modo Edição) -->
             <div class="tutor-card fixed">
               <div class="tutor-avatar">
                 <span>{{ petTutor.name.charAt(0).toUpperCase() }}</span>
               </div>
               <div class="tutor-info">
                 <h4>{{ petTutor.name }}</h4>
                 <div class="tutor-details">
                   <span class="tutor-cpf">CPF: {{ formatCPF(petTutor.cpf) }}</span>
                   @if (petTutor.phone) {
                     <span class="tutor-phone">Tel: {{ formatPhone(petTutor.phone) }}</span>
                   }
                   @if (petTutor.email) {
                     <span class="tutor-email">{{ petTutor.email }}</span>
                   }
                 </div>
                 <div class="tutor-note">
                   <small>⚠️ O tutor não pode ser alterado nesta tela. Use a área de migração para transferir o pet.</small>
                 </div>
               </div>
             </div>
           } @else if (selectedTutor) {
             <!-- Cartão do Tutor Selecionado (Modo Criação com tutor pré-selecionado) -->
             <div class="tutor-card">
               <div class="tutor-avatar">
                 <span>{{ selectedTutor.name.charAt(0).toUpperCase() }}</span>
               </div>
               <div class="tutor-info">
                 <h4>{{ selectedTutor.name }}</h4>
                 <div class="tutor-details">
                   <span class="tutor-cpf">CPF: {{ formatCPF(selectedTutor.cpf) }}</span>
                   @if (selectedTutor.phone) {
                     <span class="tutor-phone">Tel: {{ formatPhone(selectedTutor.phone) }}</span>
                   }
                   @if (selectedTutor.email) {
                     <span class="tutor-email">{{ selectedTutor.email }}</span>
                   }
                 </div>
               </div>
             </div>
           } @else {
             <!-- Select de Tutor (Modo Criação sem tutor pré-selecionado) -->
             <div class="form-group">
               <label for="tutorId">Tutor *</label>
               <select 
                 id="tutorId" 
                 formControlName="tutorId"
                 [class.error]="petForm.get('tutorId')?.invalid && petForm.get('tutorId')?.touched"
               >
                 <option value="">Selecione o tutor</option>
                 @for (tutor of tutors; track tutor.id) {
                   <option [value]="tutor.id">{{ tutor.name }} - {{ tutor.cpf }}</option>
                 }
               </select>
               @if (petForm.get('tutorId')?.invalid && petForm.get('tutorId')?.touched) {
                 <span class="error-text">Tutor é obrigatório</span>
               }
             </div>
           }
         </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <app-button
          variant="ghost"
          label="Cancelar"
          (clicked)="onCancel()">
        </app-button>
        <app-button
          type="submit"
          variant="primary"
          icon="check"
          [label]="isEditMode ? 'Atualizar Pet' : 'Cadastrar Pet'"
          [loading]="loading"
          [disabled]="petForm.invalid">
        </app-button>
      </div>
    </form>
  }
</div>
